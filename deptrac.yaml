deptrac:
  paths:
    - ./src

  layers:
    # Architectural layers
    - name: Domain
      collectors:
        - type: directory
          value: src/Modules/.*/Domain/.*

    - name: Application
      collectors:
        - type: directory
          value: src/Modules/.*/Application/.*

    - name: Infrastructure
      collectors:
        - type: directory
          value: src/Modules/.*/Infrastructure/.*

    - name: Http
      collectors:
        - type: directory
          value: src/Http/.*
        - type: directory
          value: src/Modules/.*/Http/.*

    - name: Shared
      collectors:
        - type: directory
          value: src/Shared/.*

    - name: Database
      collectors:
        - type: directory
          value: src/Database/.*

    - name: Views
      collectors:
        - type: directory
          value: src/Views/.*

    - name: ServiceProvider
      collectors:
        - type: classNameRegex
          value: '/^App\\Modules\\.*ServiceProvider$/'

  ruleset:
    # Domain layer has NO dependencies on other layers (only Shared)
    Domain:
      - Shared

    # Application depends on Domain and Shared only
    Application:
      - Domain
      - Shared

    # Infrastructure can depend on Domain, Application, Shared, and Database
    Infrastructure:
      - Domain
      - Application
      - Shared
      - Database

    # HTTP layer can depend on Application, Domain, Shared, Database
    Http:
      - Application
      - Domain
      - Shared
      - Database

    # Shared can depend on Database (QueryBuilder wraps Database)
    # CliBootstrap needs ServiceProviders for bootstrapping
    Shared:
      - Database
      - ServiceProvider

    # Database is infrastructure-level, depends on Shared only
    Database:
      - Shared

    # ServiceProviders wire everything together, can depend on all layers
    ServiceProvider:
      - Domain
      - Application
      - Infrastructure
      - Http
      - Shared
      - Database

